process MCCand = {
#includes
include "FWCore/MessageLogger/data/MessageLogger.cfi"
include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"
include "PhysicsTools/HepMCCandAlgos/data/genParticleCandidates.cfi"
include "PhysicsTools/HepMCCandAlgos/data/setMotherReferences.cfi"
include "PhysicsTools/RecoCandAlgos/data/allTracks.cfi"

#services
#  service = Tracer { untracked string indention = ">>" }

#event source
  source = PoolSource {
    untracked vstring fileNames = { "file:events.root" }
  }

#modules
  module tracks = CandShallowCloneProducer {
    InputTag src = allTracks
  }

  module V0s = CandCombiner {
    string decay = "tracks@+ tracks@-"
    string cut = "0 < mass < 2.5"
  }

  module mcMatch = MCTruthDeltaRMatcher {
    InputTag src = allTracks
    InputTag matched = genParticleCandidates
    double distMin = 0.2
  }

  module compMatch = MCTruthCompositeMatcher {
    InputTag src = V0s
    InputTag matchMap = mcMatch
  }

  module trueV0s = MCTruthMatchFlagProducer {
    InputTag src = V0s
    InputTag matchMap = compMatch
    vint32 pdgId = { 113 } # rho0, K*0, 
  }

  block histoLimits = {
   double massMin = 0
   double massMax = 3
   double ptMax = 100
  }

  module histo = CandHistoAnalyzer {
   InputTag src = V0s
   untracked string histoutputFile = "histo.root"
   using histoLimits
  }

  module KstarHisto = CandHistoAnalyzer {
   InputTag src =trueV0s
   untracked string histoutputFile = "histo_true.root"
   using histoLimits
  }

#output modules
  module out = PoolOutputModule { 
    untracked string fileName = "genanal.root" 
    untracked vstring outputCommands = {
      "keep *"
    }  
  }

  module printEventNumber = AsciiOutputModule { }

#paths
  path gen = { 
    genParticleCandidates, setMotherReferences 
  }

  path reco = {
    allTracks, tracks, V0s 
  }

  path match = {
    mcMatch, compMatch, trueV0s
  }

  path analysis = {
    histo, KstarHisto
  }

  endpath o = { 
    out, printEventNumber 
  }
}
